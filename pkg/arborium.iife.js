var arborium=(function(p){"use strict";const Y="0.0.0",J=["ada","agda","asciidoc","asm","awk","bash","batch","c","c-sharp","caddy","capnp","clojure","cmake","commonlisp","cpp","css","d","dart","devicetree","diff","dockerfile","dot","elisp","elixir","elm","erlang","fish","fsharp","gleam","glsl","go","graphql","haskell","hcl","hlsl","html","idris","ini","java","javascript","jinja2","jq","json","julia","kdl","kotlin","lean","lua","markdown","matlab","meson","nginx","ninja","nix","objc","ocaml","perl","php","postscript","powershell","prolog","python","query","r","rescript","ron","ruby","rust","scala","scheme","scss","sparql","sql","ssh-config","starlark","svelte","swift","textproto","thrift","tlaplus","toml","tsx","typescript","typst","uiua","vb","verilog","vhdl","vim","vue","x86asm","xml","yaml","yuri","zig","zsh"],K={manual:!1,theme:"one-dark",selector:"pre code",cdn:"jsdelivr",version:Y,pluginsUrl:"",hostUrl:""};let b=null,w=null,c={...K};const L=new Map,E=new Set(J);let d=null,y=null;async function Q(){if(c.pluginsUrl)return y||(y=(async()=>{console.debug(`[arborium] Loading local plugins manifest from: ${c.pluginsUrl}`);const t=await fetch(c.pluginsUrl);if(!t.ok)throw new Error(`Failed to load plugins.json: ${t.status}`);d=await t.json(),console.debug(`[arborium] Loaded local manifest with ${d?.entries.length} entries`)})(),y)}function V(t){if(d){const r=d.entries.find(o=>o.language===t);if(r)return r.local_js.substring(0,r.local_js.lastIndexOf("/"))}const s=c.cdn,e=c.version;let n;return s==="jsdelivr"?n="https://cdn.jsdelivr.net/npm":s==="unpkg"?n="https://unpkg.com":n=s,`${n}/@arborium/${t}@${e}`}async function x(t){const s=L.get(t);if(s)return console.debug(`[arborium] Grammar '${t}' found in cache`),s;if(await Q(),!E.has(t)&&!d?.entries.some(e=>e.language===t))return console.debug(`[arborium] Grammar '${t}' not available`),null;try{const e=V(t),n=`${e}/grammar.js`,r=`${e}/grammar_bg.wasm`;console.debug(`[arborium] Loading grammar '${t}' from ${n}`);const o=await import(n);await o.default(r);const i=o.language_id();i!==t&&console.warn(`[arborium] Language ID mismatch: expected '${t}', got '${i}'`);const l=o.injection_languages(),j={languageId:t,injectionLanguages:l,module:o,parse:$=>{const f=o.create_session();try{o.set_text(f,$);const a=o.parse(f);return{spans:a.spans||[],injections:a.injections||[]}}catch(a){return console.error("[arborium] Parse error:",a),{spans:[],injections:[]}}finally{o.free_session(f)}}};return L.set(t,j),console.debug(`[arborium] Grammar '${t}' loaded successfully`),j}catch(e){return console.error(`[arborium] Failed to load grammar '${t}':`,e),null}}const S=new Map;let X=1;function Z(){window.arboriumHost={isLanguageAvailable(t){return E.has(t)||L.has(t)},async loadGrammar(t){const s=await x(t);if(!s)return 0;for(const[n,r]of S)if(r===s)return n;const e=X++;return S.set(e,s),e},parse(t,s){const e=S.get(t);return e?e.parse(s):{spans:[],injections:[]}}}}function tt(){if(c.hostUrl)return c.hostUrl;const t=c.cdn,s=c.version;let e;t==="jsdelivr"?e="https://cdn.jsdelivr.net/npm":t==="unpkg"?e="https://unpkg.com":e=t;const n=s==="latest"?"":`@${s}`;return`${e}/@arborium/arborium${n}/dist`}async function et(){return b||w||(w=(async()=>{Z();const t=tt(),s=`${t}/arborium_host.js`,e=`${t}/arborium_host_bg.wasm`;console.debug(`[arborium] Loading host from ${s}`);try{const n=await import(s);return await n.default(e),b={highlight:n.highlight,isLanguageAvailable:n.isLanguageAvailable},console.debug("[arborium] Host loaded successfully"),b}catch(n){return console.error("[arborium] Failed to load host:",n),null}})(),w)}async function T(t,s,e){const n=await et();if(n)try{return n.highlight(t,s)}catch(i){console.warn("Host highlight failed, falling back to JS:",i)}const r=await x(t);if(!r)return v(s);const o=r.parse(s);return P(s,o.spans)}async function M(t,s){const e=await x(t);if(!e)return null;const{module:n}=e;return{languageId:()=>e.languageId,injectionLanguages:()=>e.injectionLanguages,highlight:async r=>{const o=e.parse(r);return P(r,o.spans)},parse:r=>e.parse(r),createSession:()=>{const r=n.create_session();return{setText:o=>n.set_text(r,o),parse:()=>{try{const o=n.parse(r);return{spans:o.spans||[],injections:o.injections||[]}}catch(o){return console.error("[arborium] Session parse error:",o),{spans:[],injections:[]}}},cancel:()=>n.cancel(r),free:()=>n.free_session(r)}},dispose:()=>{}}}function P(t,s){const e=[...s].sort((o,i)=>o.start-i.start);let n="",r=0;for(const o of e){if(o.start<r)continue;o.start>r&&(n+=v(t.slice(r,o.start)));const i=st(o.capture),l=v(t.slice(o.start,o.end));i?n+=`<a-${i}>${l}</a-${i}>`:n+=l,r=o.end}return r<t.length&&(n+=v(t.slice(r))),n}function st(t){return t.startsWith("keyword")||t==="include"||t==="conditional"?"k":t.startsWith("function")||t.startsWith("method")?"f":t.startsWith("string")||t==="character"?"s":t.startsWith("comment")?"c":t.startsWith("type")?"t":t.startsWith("variable")?"v":t.startsWith("number")||t==="float"?"n":t.startsWith("operator")?"o":t.startsWith("punctuation")?"p":t.startsWith("tag")?"tg":t.startsWith("attribute")?"at":null}function v(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function C(t){return t?{...c,...t}:{...c}}function _(t){c={...c,...t}}const nt=[[/^#!.*\bpython[23]?\b/,"python"],[/^#!.*\bnode\b/,"javascript"],[/^#!.*\bdeno\b/,"typescript"],[/^#!.*\bbun\b/,"typescript"],[/^#!.*\bruby\b/,"ruby"],[/^#!.*\bperl\b/,"perl"],[/^#!.*\bphp\b/,"php"],[/^#!.*\bbash\b/,"bash"],[/^#!.*\bzsh\b/,"zsh"],[/^#!.*\bsh\b/,"bash"],[/^#!.*\blua\b/,"lua"],[/^#!.*\bawk\b/,"awk"]],rt=[[/\b(fn|impl|trait|pub\s+fn|let\s+mut|&mut|->)\b/,"rust"],[/\b(func|package\s+\w+|import\s+\(|go\s+func|chan\s+\w+)\b/,"go"],[/\b(def\s+\w+\s*\(|import\s+\w+|from\s+\w+\s+import|class\s+\w+:)\b/,"python"],[/:\s*(string|number|boolean|void)\b|\binterface\s+\w+\s*\{/,"typescript"],[/\b(const|let|var)\s+\w+\s*=|function\s+\w+\s*\(|=>\s*\{/,"javascript"],[/\b(def\s+\w+|end\b|do\s*\|.*\||puts\s+|require\s+['"])\b/,"ruby"],[/\b(public\s+class|private\s+\w+|System\.out\.println)\b/,"java"],[/\b(#include\s*<|std::|template\s*<|nullptr|cout\s*<<)\b/,"cpp"],[/\b(#include\s*[<"]|printf\s*\(|int\s+main\s*\(|void\s+\w+\s*\()\b/,"c"],[/\b(namespace\s+\w+|using\s+System|public\s+static\s+void)\b/,"c-sharp"],[/<\?php|\$\w+\s*=/,"php"],[/\b(func\s+\w+|var\s+\w+:\s*\w+|let\s+\w+:\s*\w+|@objc)\b/,"swift"],[/\b(fun\s+\w+|val\s+\w+|var\s+\w+:|data\s+class)\b/,"kotlin"],[/\b(def\s+\w+|val\s+\w+|var\s+\w+|object\s+\w+|case\s+class)\b/,"scala"],[/\b(module\s+\w+|import\s+qualified|data\s+\w+\s*=|::\s*\w+\s*->)\b/,"haskell"],[/\b(defmodule\s+\w+|def\s+\w+|defp\s+\w+|\|>)\b/,"elixir"],[/\b(local\s+\w+\s*=|function\s+\w+\.\w+|require\s*\()\b/,"lua"],[/\b(SELECT\s+.*\s+FROM|INSERT\s+INTO|CREATE\s+TABLE|ALTER\s+TABLE)\b/i,"sql"],[/\b(if\s+\[\s*|then\b|fi\b|echo\s+["']|export\s+\w+=)\b/,"bash"],[/^\s*[\w-]+:\s*[\w\-"'[{]|^---\s*$/,"yaml"],[/^\s*\{[\s\S]*"[\w-]+":\s*/,"json"],[/^\s*\[[\w.-]+\]\s*$|^\s*\w+\s*=\s*["'\d\[]/,"toml"],[/<(!DOCTYPE|html|head|body|div|span|p|a\s)/i,"html"],[/^\s*[\w.#@][\w\s,#.:>+~-]*\{[^}]*\}|@media\s|@import\s/,"css"],[/^#{1,6}\s+\w|^\s*[-*+]\s+\w|^\s*\d+\.\s+\w|```\w*\n/,"markdown"],[/<\?xml|<[\w:-]+\s+xmlns/,"xml"],[/^FROM\s+\w+|^RUN\s+|^COPY\s+|^ENTRYPOINT\s+/m,"dockerfile"],[/\b(server\s*\{|location\s+[\/~]|proxy_pass\s+)\b/,"nginx"],[/\b(pub\s+fn|const\s+\w+\s*=|@import\(|comptime)\b/,"zig"]];function I(t){const s=t.split(`
`)[0];for(const[e,n]of nt)if(e.test(s))return n;for(const[e,n]of rt)if(e.test(t))return n;return null}function R(t){const s=t.match(/\blanguage-(\w+)\b/);if(s)return s[1];const e=t.match(/\blang-(\w+)\b/);if(e)return e[1];const n=new Set(["rust","javascript","typescript","python","ruby","go","java","c","cpp","csharp","php","swift","kotlin","scala","haskell","elixir","lua","sql","bash","shell","yaml","json","toml","html","css","xml","markdown","dockerfile","nginx","zig","text","plaintext","console","sh"]);for(const r of t.split(/\s+/))if(n.has(r.toLowerCase()))return r.toLowerCase();return null}function k(t){const s={js:"javascript",ts:"typescript",py:"python",rb:"ruby",rs:"rust",sh:"bash",shell:"bash",yml:"yaml",cs:"c-sharp",csharp:"c-sharp","c++":"cpp","c#":"c-sharp","f#":"fsharp",dockerfile:"dockerfile",docker:"dockerfile",makefile:"make",plaintext:"text",plain:"text",txt:"text"},e=t.toLowerCase();return s[e]||e}const u=document.currentScript;function ot(){if(!u?.src)return new URLSearchParams;try{return new URL(u.src).searchParams}catch{return new URLSearchParams}}function at(){if(!u)return{};const t={},s=ot();u.hasAttribute("data-manual")&&(t.manual=!0);const e=u.getAttribute("data-theme");e&&(t.theme=e);const n=u.getAttribute("data-selector");n&&(t.selector=n);const r=u.getAttribute("data-cdn");r&&(t.cdn=r);const o=u.getAttribute("data-version");o&&(t.version=o);const i=s.get("pluginsUrl");i&&(t.pluginsUrl=i);const l=s.get("hostUrl");return l&&(t.hostUrl=l),t}function q(){return document.querySelector('meta[name="generator"]')?.getAttribute("content")==="rustdoc"}function it(t){if(!t)return null;const s={light:"rustdoc-light",dark:"rustdoc-dark",ayu:"rustdoc-ayu"};return s[t]?s[t]:null}function B(){if(q()){const s=it(document.documentElement.dataset.theme);if(s)return s}return window.matchMedia("(prefers-color-scheme: light)").matches?"github-light":"one-dark"}function m(){const t=window.Arborium||{},s=at(),e={...t,...s};return e.theme||(e.theme=B()),_(e),C()}function ct(t){return Array.from(document.querySelectorAll(t))}function lt(t){const s=["hljs","highlighted","prism-code","shiki"];for(const r of s)if(t.classList.contains(r))return!0;const e=t.querySelectorAll("span[class]");return e.length>0&&Array.from(e).filter(o=>o.className&&o.className.length>0).length>=3||t.querySelectorAll("a").length>=2}function H(t){const s=t.getAttribute("data-lang");if(s)return k(s);const e=t.className,n=R(e);if(n)return k(n);const r=t.parentElement;if(r){const i=r.getAttribute("data-lang");if(i)return k(i);const l=R(r.className);if(l)return k(l)}const o=t.textContent||"";return I(o)}function N(){const t=m();if(t.hostUrl)return`${t.hostUrl}/themes`;const s=t.cdn,e=t.version;let n;s==="jsdelivr"?n="https://cdn.jsdelivr.net/npm":s==="unpkg"?n="https://unpkg.com":n=s;const r=e==="latest"?"":`@${e}`;return`${n}/@arborium/arborium${r}/dist/themes`}function ut(){const t="arborium-base";if(document.getElementById(t))return;const s=`${N()}/base-rustdoc.css`;console.debug(`[arborium] Loading base CSS: ${s}`);const e=document.createElement("link");e.id=t,e.rel="stylesheet",e.href=s,document.head.appendChild(e)}let g=null;function W(t){if(g&&g!==t){const r=document.getElementById(`arborium-theme-${g}`);r&&(r.remove(),console.debug(`[arborium] Removed theme: ${g}`))}const s=`arborium-theme-${t}`;if(document.getElementById(s)){g=t;return}const e=`${N()}/${t}.css`;console.debug(`[arborium] Loading theme: ${e}`);const n=document.createElement("link");n.id=s,n.rel="stylesheet",n.href=e,document.head.appendChild(n),g=t}async function F(t,s,e){const n=t.textContent||"";if(n.trim())try{const r=await T(s,n,e);t.innerHTML=r,t.setAttribute("data-highlighted","true"),t.setAttribute("data-lang",s)}catch(r){console.warn(`[arborium] Failed to highlight ${s}:`,r)}}async function U(){const t=m();ut(),W(t.theme);const s=ct(t.selector);if(s.length===0)return;const e=new Map,n=[];for(const a of s){if(a.hasAttribute("data-highlighted")||lt(a))continue;const h=H(a);if(h){const A=e.get(h)||[];A.push(a),e.set(h,A)}else n.push(a)}const r=Array.from(e.keys()),o=r.map(a=>M(a).catch(h=>(console.warn(`[arborium] Failed to load grammar for ${a}:`,h),null))),i=await Promise.all(o),l=[];for(let a=0;a<r.length;a++){const h=r[a];if(!i[a])continue;const ht=e.get(h)||[];for(const mt of ht)l.push(F(mt,h,t))}await Promise.all(l);const j=s.length,$=s.filter(a=>a.hasAttribute("data-highlighted")).length,f=n.length;($>0||f>0)&&console.debug(`[arborium] Highlighted ${$}/${j} blocks`+(f>0?` (${f} unknown language)`:""))}async function O(t){C({...m(),...t}),await U()}async function G(t,s,e){const n=C({...m(),...e}),r=s||H(t);if(!r){console.warn("[arborium] Could not detect language for element");return}await F(t,r,n)}window.arborium={highlightAll:O,highlightElement:G,loadGrammar:M,highlight:T,detectLanguage:I,config:m()};async function z(){const t=B();g!==t&&(_({theme:t}),window.arborium.config=m(),W(t),console.debug(`[arborium] Theme changed to: ${t}`))}function D(){new MutationObserver(s=>{for(const e of s)if(e.attributeName==="data-theme"&&q()){z();break}}).observe(document.documentElement,{attributes:!0}),window.matchMedia("(prefers-color-scheme: light)").addEventListener("change",()=>z())}return m().manual||(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{U(),D()}):(U(),D())),p.highlightAll=O,p.highlightElement=G,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"}),p})({});
//# sourceMappingURL=arborium.iife.js.map
